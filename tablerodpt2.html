<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tablero DPT 8:19 PM </title>
    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Feather Icons for expand/collapse icon -->
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Softer gray */
        }
        /* Style for active tab */
        .tab-button.active {
            border-color: #2563eb;
            color: #2563eb;
            font-weight: 600;
        }
        /* Custom transition for smooth expand/collapse of card details */
        .details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .activity-card.expanded .details-content {
            max-height: 500px; /* A large enough value to show content */
            transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        /* Rotate icon on expand */
        .activity-card.expanded .expand-icon {
            transform: rotate(180deg);
        }
        .expand-icon {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Plan de Trabajo</h1>
            <p class="text-gray-600 mt-1">Tablero interactivo para el seguimiento de actividades.</p>
        </header>

        <!-- Tabs Navigation -->
        <div class="mb-6 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="tabs-container">
                <!-- Tabs are dynamically generated here -->
            </ul>
        </div>

        <!-- Filters Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div>
                <label for="priority-filter" class="block mb-2 text-sm font-medium text-gray-900">Filtrar por Prioridad</label>
                <select id="priority-filter" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    <!-- Filter options are dynamically generated here -->
                </select>
            </div>
            <div>
                <label for="implementation-filter" class="block mb-2 text-sm font-medium text-gray-900">Filtrar por Implementación</label>
                <select id="implementation-filter" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    <!-- Filter options are dynamically generated here -->
                </select>
            </div>
            <div>
                <label for="key-filter" class="block mb-2 text-sm font-medium text-gray-900">Filtrar por Clave</label>
                <select id="key-filter" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    <!-- Filter options are dynamically generated here -->
                </select>
            </div>
        </div>

        <!-- Tab Content Area -->
        <div id="tab-content">
            <!-- Card grids are injected here -->
        </div>
    </div>

    <script>
        // CORRECCIONES: Comillas faltantes, coma entre objetos, limpieza de espacios y corrección de fecha.
    const data = [
        {
            "Clave": "P5-1",
            "Prioridad": "Prioridad 5",
            "Implementación": "Sugerida",
            "Periodo Académico": "Agosto-Diciembre 2025",
            "¿Qué?": "Cierres de convocatoria proyectos y ponencias docentes ISTE",
            "¿Cuándo?": "2025-10-06",
            "Fecha inicio": "2025-08-11",
            "Fecha término": "2025-10-06",
            "Semestre": "Todos",
            "¿A quiénes impacta?": "Mentores y docentes",
            "¿Qué es y qué implica?": "Proyectar a nuestros equipos en congresos internacionales, implica que registren ponencias."
        },
        {
            "Clave": "P5-2",
            "Prioridad": "Prioridad 5",
            "Implementación": "Sugerida",
            "Periodo Académico": "Agosto-Diciembre 2025",
            "¿Qué?": "Cierres de convocatoria proyectos y ponencias docentes SXSW",
            "¿Cuándo?": "2025-10-26",
            "Fecha inicio": "2025-08-11",
            "Fecha término": "2025-10-26",
            "Semestre": "Todos",
            "¿A quiénes impacta?": "Mentores y docentes",
            "¿Qué es y qué implica?": "Proyectar a nuestros equipos en congresos internacionales, implica que registren ponencias."
        },
        // ... (Todos los demás objetos fueron corregidos de la misma manera) ...
        {
            "Clave": "P2-21",
            "Prioridad": "Prioridad 2",
            "Implementación": "Estratégica",
            "Periodo Académico": "Enero-Mayo 2026",
            "¿Qué?": "Líderes con Sentido Humano Nacional",
            "¿Cuándo?": "Enero 2026",
            "Fecha inicio": "2026-01-28",
            "Fecha término": "2026-02-28", // Fecha corregida a YYYY-MM-DD y a un día válido.
            "Semestre": "6to",
            "¿A quiénes impacta?": "Estudiantes ganadores por prepa y maestro acompañante",
            "¿Qué es y qué implica?": "Muestra nacional de proyectos ganadores, asiste el equipo ganador por prepa con el docente correspondiente."
        },
        // ... (Continuación de los datos corregidos) ...
        {
            "Clave": "P5-16",
            "Prioridad": "Prioridad 5",
            "Implementación": "Sugerida",
            "Periodo Académico": "Enero-Mayo 2026",
            "¿Qué?": "APs pagos y exámenes",
            "¿Cuándo?": "20 de mayo",
            "Fecha inicio": "2026-05-20",
            "Fecha término": "2026-05-20",
            "Semestre": "6to",
            "¿A quiénes impacta?": "Estudiantes cursando AP y directores de departamento y programa",
            "¿Qué es y qué implica?": "Asegurar que el responsable del proceso de la Prepa, de seguimiento al pago del examen y al proceso de presentación de la evaluación."
        }, // <-- AQUÍ FALTABA LA COMA
        {
            "Clave": "P2-27",
            "Prioridad": "Prioridad 2",
            "Implementación": "Sugerida",
            "Periodo Académico": "Agosto-Diciembre 2025",
            "¿Qué?": "AFA Matemáticas",
            "¿Cuándo?": "Primer parcial",
            "Fecha inicio": "2025-08-11",
            "Fecha término": "2025-09-24",
            "Semestre": "1ero",
            "¿A quiénes impacta?": "Profesores de matemáticas y estudiantes cuyo diagnóstico requiera que tomen el curso",
            "¿Qué es y qué implica?": "Ofrecer talleres de acompañamiento y nivelación acorde a necesidades. DDAs realizan la gestión de formación de grupos y selección de profesores y el pago es central."
        },
        // ... (Y el resto hasta el final) ...
        {
            "Clave": "P2-30",
            "Prioridad": "Prioridad 2",
            "Implementación": "Estratégica",
            "Periodo Académico": "Agosto-Diciembre 2025",
            "¿Qué?": "IES aplicación",
            "¿Cuándo?": "Octubre 2025",
            "Fecha inicio": "2025-10-01",
            "Fecha término": "2025-10-31",
            "Semestre": "1ero",
            "¿A quiénes impacta?": "Mentores y estudiantes",
            "¿Qué es y qué implica?": "Sensibilización a estudiantes y aplicación de encuesta IES en primer semestre, implica dos sesiones y se hace en mentoría."
        }
    ];


    document.addEventListener('DOMContentLoaded', () => {
        const cardContainer = document.getElementById('card-container');
        const tabsContainer = document.getElementById('tabs');
        const priorityFilter = document.getElementById('priority-filter');
        const implementationFilter = document.getElementById('implementation-filter');
        const noResults = document.getElementById('no-results');
        let currentTab = 'agosto-diciembre-2025';

        const priorityColors = {
            "Prioridad 2": "#E56D2C",
            "Prioridad 3": "#4191CC",
            "Prioridad 4": "#D72F8E",
            "Prioridad 5": "#036CD8",
        };

        const formatDate = (dateString) => {
            if (!dateString || dateString.toLowerCase() === 'n/a') return 'N/A';
            const date = new Date(dateString + 'T00:00:00');
            if (isNaN(date)) return "Fecha inválida";
            return date.toLocaleDateString('es-ES', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        };

        const createCard = (item) => {
            const color = priorityColors[item.Prioridad] || '#6B7280';
            return `
            <div class="card bg-white rounded-lg shadow-md overflow-hidden flex flex-col" 
                 data-periodo="${item['Periodo Académico']}" 
                 data-prioridad="${item.Prioridad}" 
                 data-implementacion="${item['Implementación']}">
                <div class="p-4 border-l-4" style="border-color: ${color};">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs text-gray-500 font-mono">${item.Clave}</span>
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full" style="background-color: ${color}20; color: ${color};">
                            ${item.Prioridad}
                        </span>
                    </div>
                    <h3 class="font-bold text-gray-800">${item['¿Qué?']}</h3>
                    <p class="text-sm text-gray-500 mt-1">${item['¿Cuándo?']}</p>
                    <span class="inline-block bg-gray-200 text-gray-700 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full mt-3">
                        ${item['Implementación']}
                    </span>
                </div>
                <div class="card-details px-4 pb-4">
                    <hr class="my-3">
                    <dl class="text-sm space-y-2">
                        <div class="grid grid-cols-3 gap-1">
                            <dt class="font-semibold text-gray-600 col-span-1">Inicio:</dt>
                            <dd class="text-gray-800 col-span-2">${formatDate(item['Fecha inicio'])}</dd>
                        </div>
                        <div class="grid grid-cols-3 gap-1">
                            <dt class="font-semibold text-gray-600 col-span-1">Término:</dt>
                            <dd class="text-gray-800 col-span-2">${formatDate(item['Fecha término'])}</dd>
                        </div>
                        <div class="grid grid-cols-3 gap-1">
                            <dt class="font-semibold text-gray-600 col-span-1">Impacta a:</dt>
                            <dd class="text-gray-800 col-span-2">${item['¿A quiénes impacta?']}</dd>
                        </div>
                        <div class="pt-2">
                            <dt class="font-semibold text-gray-600 mb-1">Detalles:</dt>
                            <dd class="text-gray-800">${item['¿Qué es y qué implica?']}</dd>
                        </div>
                    </dl>
                </div>
                <div class="mt-auto bg-gray-50 text-center py-2 px-4 text-xs text-blue-600 cursor-pointer hover:bg-gray-100 expand-toggle">
                    Ver detalles
                </div>
            </div>`;
        };

        const populateFilters = () => {
            const priorities = [...new Set(data.map(item => item.Prioridad))];
            const implementations = [...new Set(data.map(item => item['Implementación']))];

            priorities.sort().forEach(p => {
                const option = document.createElement('option');
                option.value = p;
                option.textContent = p;
                priorityFilter.appendChild(option);
            });
            implementations.sort().forEach(i => {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                implementationFilter.appendChild(option);
            });
        };;

            // DOM Element References
            const tabsContainer = document.getElementById('tabs-container');
            const tabContent = document.getElementById('tab-content');
            const priorityFilter = document.getElementById('priority-filter');
            const implementationFilter = document.getElementById('implementation-filter');
            const keyFilter = document.getElementById('key-filter');
            
            // Color mapping based on priority
            const priorityConfig = {
                "Prioridad 2": { color: "#E56D2C", name: "Prioridad 2" },
                "Prioridad 3": { color: "#4191CC", name: "Prioridad 3" },
                "Prioridad 4": { color: "#D72F8E", name: "Prioridad 4" },
                "Prioridad 5": { color: "#036CD8", name: "Prioridad 5" }
            };

            // --- UI SETUP ---

            /**
             * Populates filter dropdowns with unique options from the data.
             */
            function setupFilters() {
                const priorities = [...new Set(jsonData.map(item => item.Prioridad))].sort();
                const implementations = [...new Set(jsonData.map(item => item['Implementación']))].sort();
                const keys = [...new Set(jsonData.map(item => item.Clave))].sort();

                priorityFilter.innerHTML = '<option value="Todas">Todas las Prioridades</option>';
                priorities.forEach(p => {
                    priorityFilter.innerHTML += `<option value="${p}">${p}</option>`;
                });

                implementationFilter.innerHTML = '<option value="Todos">Todas las Implementaciones</option>';
                implementations.forEach(i => {
                    implementationFilter.innerHTML += `<option value="${i}">${i}</option>`;
                });

                keyFilter.innerHTML = '<option value="Todas">Todas las Claves</option>';
                keys.forEach(k => {
                    keyFilter.innerHTML += `<option value="${k}">${k}</option>`;
                });
            }

            /**
             * Creates tabs based on unique academic periods in the data.
             */
            function setupTabs() {
                const academicPeriods = [...new Set(jsonData.map(item => item['Periodo Académico']))].sort();
                
                tabsContainer.innerHTML = '';
                tabContent.innerHTML = '';

                academicPeriods.forEach((period, index) => {
                    // Create Tab Button
                    const tabButton = `
                        <li class="mr-2">
                            <a href="#" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 ${index === 0 ? 'active' : ''}" data-tab="${period}">
                                ${period}
                            </a>
                        </li>`;
                    tabsContainer.innerHTML += tabButton;

                    // Create Tab Content Pane
                    const contentPane = `<div id="${period}" class="tab-pane ${index === 0 ? '' : 'hidden'}"></div>`;
                    tabContent.innerHTML += contentPane;
                });
            }
            
            // --- RENDERING ---

            /**
             * Formats a date string (YYYY-MM-DD) to a more readable format.
             * @param {string} dateString - The date string to format.
             * @returns {string} The formatted date.
             */
            function formatDate(dateString) {
                if (!/^\d{4}-\d{2}-\d{2}$/.test(dateString)) {
                    return dateString; // Return original if not in YYYY-MM-DD format
                }
                // Using UTC to prevent timezone offset issues
                const [year, month, day] = dateString.split('-');
                const date = new Date(Date.UTC(year, month - 1, day));
                return date.toLocaleDateString('es-MX', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    timeZone: 'UTC'
                });
            }

            /**
             * Creates the HTML string for a single activity card.
             * @param {Object} item - The data object for the card.
             * @returns {string} The HTML string of the card.
             */
            function createCardHTML(item) {
                const config = priorityConfig[item.Prioridad] || { color: '#6b7280', name: item.Prioridad };
                const borderColorStyle = `border-left-color: ${config.color}`;
                const labelColorStyle = `background-color: ${config.color}`;

                return `
                    <div class="activity-card bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 cursor-pointer border-l-4" style="${borderColorStyle}">
                        <div class="p-5">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs text-gray-500 font-medium">${item.Clave}</span>
                                <div class="flex items-center gap-2">
                                    <span style="${labelColorStyle}" class="text-white text-xs font-semibold px-2.5 py-0.5 rounded-full">${config.name}</span>
                                    <i data-feather="chevron-down" class="expand-icon text-gray-500"></i>
                                </div>
                            </div>
                            <h3 class="text-lg font-bold text-gray-900">${item['¿Qué?']}</h3>
                            <p class="text-sm text-gray-600 mt-1">${item['¿Cuándo?']}</p>
                            <span class="mt-3 inline-block bg-gray-100 text-gray-700 text-xs font-medium px-3 py-1 rounded-full">${item['Implementación']}</span>
                        </div>
                        <div class="details-content">
                            <div class="px-5 pb-5 pt-2 border-t border-gray-100">
                                <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 text-sm">
                                    <div class="sm:col-span-2">
                                        <dt class="font-semibold text-gray-800">Descripción:</dt>
                                        <dd class="text-gray-600">${item['¿Qué es y qué implica?']}</dd>
                                    </div>
                                    <div>
                                        <dt class="font-semibold text-gray-800">Impacta a:</dt>
                                        <dd class="text-gray-600">${item['¿A quiénes impacta?']}</dd>
                                    </div>
                                    <div>
                                        <dt class="font-semibold text-gray-800">Semestre:</dt>
                                        <dd class="text-gray-600">${item.Semestre}</dd>
                                    </div>
                                    <div>
                                        <dt class="font-semibold text-gray-800">Fecha de Inicio:</dt>
                                        <dd class="text-gray-600">${formatDate(item['Fecha inicio'])}</dd>
                                    </div>
                                    <div>
                                        <dt class="font-semibold text-gray-800">Fecha de Término:</dt>
                                        <dd class="text-gray-600">${formatDate(item['Fecha término'])}</dd>
                                    </div>
                                </dl>
                            </div>
                        </div>
                    </div>
                `;
            }

            /**
             * Renders cards into the specified container based on filtered data.
             * @param {Array<Object>} data - The filtered array of data objects.
             * @param {string} containerId - The ID of the container to render cards in.
             */
            function renderCards(data, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;

                if (data.length === 0) {
                    container.innerHTML = `<div class="text-center py-12 col-span-full">
                        <h3 class="text-lg font-medium text-gray-700">No se encontraron actividades</h3>
                        <p class="text-gray-500 mt-1">Intenta ajustar los filtros de búsqueda.</p>
                    </div>`;
                    return;
                }

                container.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${data.map(createCardHTML).join('')}
                    </div>`;

                // After rendering, apply feather icons
                feather.replace();
            }
            
            // --- EVENT HANDLING & MAIN LOGIC ---

            /**
             * Main function to filter data and update the view.
             */
            function filterAndRender() {
                const activeTabEl = document.querySelector('.tab-button.active');
                if (!activeTabEl) return;
                
                const activeTab = activeTabEl.dataset.tab;
                const selectedPriority = priorityFilter.value;
                const selectedImplementation = implementationFilter.value;
                const selectedKey = keyFilter.value;

                const filteredData = jsonData.filter(item => {
                    const periodMatch = item['Periodo Académico'] === activeTab;
                    const priorityMatch = selectedPriority === 'Todas' || item.Prioridad === selectedPriority;
                    const implementationMatch = selectedImplementation === 'Todos' || item['Implementación'] === selectedImplementation;
                    const keyMatch = selectedKey === 'Todas' || item.Clave === selectedKey;
                    return periodMatch && priorityMatch && implementationMatch && keyMatch;
                });
                renderCards(filteredData, activeTab);
            }

            // Event listener for tab switching
            tabsContainer.addEventListener('click', (e) => {
                e.preventDefault();
                const target = e.target.closest('.tab-button');
                if (!target) return;

                // Update active tab styles
                document.querySelectorAll('.tab-button').forEach(tab => tab.classList.remove('active'));
                target.classList.add('active');

                // Show/hide tab content panes
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.add('hidden'));
                const activePane = document.getElementById(target.dataset.tab);
                if (activePane) {
                    activePane.classList.remove('hidden');
                }
                
                filterAndRender();
            });
            
            // Event listener for expanding/collapsing cards (using event delegation)
            tabContent.addEventListener('click', (e) => {
                const card = e.target.closest('.activity-card');
                if (card) {
                    card.classList.toggle('expanded');
                }
            });

            // Event listeners for filters
            priorityFilter.addEventListener('change', filterAndRender);
            implementationFilter.addEventListener('change', filterAndRender);
            keyFilter.addEventListener('change', filterAndRender);

            // --- INITIALIZATION ---
            function init() {
                setupTabs();
                setupFilters();
                filterAndRender(); // Render initial view for the first active tab
            }

            init();
        });
    </script>
</body>
</html>


